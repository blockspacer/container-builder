#!/bin/bash

# Get script directory
SCRIPT_DIR=$(dirname $0)

# OpenStack credentials
if [ "$1" != "--no_source" ]; then
  source ${SCRIPT_DIR}/openrc.sh
fi

# Remove Keys
if [ $(openstack keypair list | grep "\<BuilderKey\>" | wc -l) == 1 ]; then
    openstack keypair delete BuilderKey
    rm ${SCRIPT_DIR}/BuilderKey
fi

# Remove IP files
rm -f ${SCRIPT_DIR}/BuilderIP

# Delete VM
if [ $(openstack server list | grep "\<Builder\>" | wc -l) == 1 ]; then
    openstack server stop --wait BuilderMaster
fi

# Delete the image
if [ $(openstack image list | grep "\<Builder\>" | wc -l) == 1 ]; then
    openstack image delete "BuilderImage"
fi