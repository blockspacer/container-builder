#!/bin/bash

# Get script directory
SCRIPT_DIR=$(dirname $0)

# OpenStack credentials
if [ "$1" != "--no_source" ]; then
    source ${SCRIPT_DIR}/openrc.sh
fi

# Remove Keys
if [ $(openstack keypair list | grep ContainerBuilderKey | wc -l) != 0 ]; then
    openstack keypair delete ContainerBuilderKey
    rm ${SCRIPT_DIR}/ContainerBuilderKey
fi

# Delete VM
if [ $(openstack server list | grep BuilderQueue | wc -l) != 0 ]; then
    openstack server delete --wait BuilderQueue
fi

# Delete the security group
if [ $(openstack security group list | grep container_builder | wc -l) != 0 ]; then
    openstack security group delete container_builder
fi